{"version":3,"file":"main.min.js","sources":["../src/main.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Main module for the decision plugin.\n *\n * @module     local_ivdecision/main\n * @copyright  2024 Sokunthearith Makara <sokunthearithmakara@gmail.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\nimport $ from 'jquery';\nimport Base from 'mod_interactivevideo/type/base';\nimport DynamicForm from 'core_form/dynamicform';\nexport default class Decision extends Base {\n    /**\n     * Initializes the decision plugin for interactive videos.\n     *\n     * This method sets up event listeners and handles the logic for decision points\n     * within the video. If the video is not in edit mode, it filters out decision\n     * annotations and prevents skipping certain decision points based on their\n     * properties.\n     *\n     * @method init\n     */\n    init() {\n        if (!this.isEditMode() && !this.isPreviewMode()) {\n            const decisions = this.annotations.filter((d) => d.type == 'decision');\n            const notSkip = decisions.filter((d) => d.char1 != 1);\n            if (notSkip.length == 0) {\n                return;\n            }\n            let self = this;\n            $(document).on('timeupdate', async function(e) {\n                const cantSkip = decisions.filter((d) => d.char1 != 1 && !d.viewed);\n                cantSkip.sort((a, b) => a.timestamp - b.timestamp);\n                if (cantSkip.length == 0) {\n                    $(`#interactions-nav .annotation`).removeClass('no-pointer');\n                    return;\n                }\n                const t = Number(e.originalEvent.detail.time);\n                const firstCantSkip = cantSkip[0];\n                if (t > Number(firstCantSkip.timestamp)) {\n                    await self.player.seek(Number(firstCantSkip.timestamp) - 0.05);\n                }\n                self.annotations.filter(a => Number(a.timestamp) > Number(firstCantSkip.timestamp)).forEach(a => {\n                    $(`#interactions-nav .annotation[data-id=${a.id}]`).addClass('no-pointer');\n                });\n                self.annotations.filter(a => Number(a.timestamp) <= Number(firstCantSkip.timestamp)).forEach(a => {\n                    $(`#interactions-nav .annotation[data-id=${a.id}]`).removeClass('no-pointer');\n                });\n            });\n        }\n    }\n\n    /**\n     * Add an annotation\n     * @param {Array} annotations The annotations array\n     * @param {number} timestamp The timestamp\n     * @param {number} coursemodule The course module id\n     * @returns {void}\n     */\n    addAnnotation(annotations, timestamp, coursemodule) {\n        $('#addcontent, #importcontent').addClass('no-pointer-events');\n        let self = this;\n        this.annotations = annotations;\n        if (!this.isBetweenStartAndEnd(timestamp)) {\n            const message = M.util.get_string('interactioncanonlybeaddedbetweenstartandendtime', 'mod_interactivevideo', {\n                \"start\": self.convertSecondsToHMS(self.start),\n                \"end\": self.convertSecondsToHMS(self.end),\n            });\n            self.addNotification(message);\n            return;\n        }\n\n        if (self.isAlreadyAdded(timestamp)) {\n            self.addNotification(M.util.get_string('interactionalreadyexists', 'mod_interactivevideo'));\n            return;\n        }\n\n        if (self.isInSkipSegment(timestamp)) {\n            self.addNotification(M.util.get_string('interactionisbetweentheskipsegment', 'mod_interactivevideo'));\n            return;\n        }\n\n        const startHMS = self.convertSecondsToHMS(self.start);\n        const endHMS = self.convertSecondsToHMS(self.end);\n        const timestampHMS = timestamp > 0 ? self.convertSecondsToHMS(timestamp) : startHMS;\n\n        const data = {\n            id: 0,\n            timestamp: timestamp > 0 ? timestamp : self.start,\n            timestampassist: timestampHMS,\n            title: self.prop.title,\n            start: startHMS,\n            end: endHMS,\n            contextid: M.cfg.contextid,\n            type: self.prop.name,\n            courseid: self.course,\n            cmid: coursemodule,\n            annotationid: self.interaction,\n            hascompletion: self.prop.hascompletion ? 1 : 0,\n        };\n\n        $('#annotationwrapper table').hide();\n        $('#annotationwrapper').append('<div id=\"form\" class=\"w-100 p-3\"></div>');\n        $(\"#contentmodal\").modal('hide');\n        $('#addcontentdropdown a').removeClass('active');\n\n        const selector = document.querySelector(`#annotationwrapper #form`);\n        const decisionform = new DynamicForm(selector, self.prop.form);\n        decisionform.load(data);\n\n        self.onEditFormLoaded(decisionform);\n        self.validateTimestampFieldValue('timestampassist', 'timestamp');\n\n        $(document).off('click', '#cancel-submit').on('click', '#cancel-submit', function(e) {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            $('#annotationwrapper #form').remove();\n            $('#annotationwrapper table').show();\n            $('#addcontent, #importcontent').removeClass('no-pointer-events');\n        });\n\n        $(document).off('click', '#submitform-submit').on('click', '#submitform-submit', function(e) {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            const event = decisionform.trigger(decisionform.events.SUBMIT_BUTTON_PRESSED);\n            if (!event.defaultPrevented) {\n                decisionform.submitFormAjax();\n            }\n        });\n\n        decisionform.addEventListener(decisionform.events.SERVER_VALIDATION_ERROR, (e) => {\n            e.stopImmediatePropagation();\n            self.onEditFormLoaded(decisionform);\n            self.validateTimestampFieldValue('timestampassist', 'timestamp');\n        });\n\n        decisionform.addEventListener(decisionform.events.FORM_SUBMITTED, (e) => {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            $.ajax({\n                url: M.cfg.wwwroot + '/mod/interactivevideo/ajax.php',\n                method: \"POST\",\n                dataType: \"text\",\n                data: {\n                    action: 'get_item',\n                    id: e.detail.id,\n                    sesskey: M.cfg.sesskey,\n                    contextid: M.cfg.courseContextId,\n                    token: self.token,\n                    cmid: self.cm,\n                },\n                success: function(data) {\n                    const newAnnotation = JSON.parse(data);\n                    self.dispatchEvent('annotationupdated', {\n                        annotation: newAnnotation,\n                        action: 'add'\n                    });\n                }\n            });\n            $('#annotationwrapper #form').remove();\n            $('#annotationwrapper table').show();\n            $('#addcontent, #importcontent').removeClass('no-pointer-events');\n        });\n    }\n\n    /**\n     * Edit an annotation\n     * @param {Array} annotations The annotations array\n     * @param {number} id The annotation id\n     * @returns {void}\n     */\n    editAnnotation(annotations, id) {\n        // Disable pointer events on some DOMs.\n        $('#addcontent, #importcontent').addClass('no-pointer-events');\n        this.annotations = annotations;\n        let self = this;\n        const annotation = annotations.find(x => x.id == id);\n        const timestamp = annotation.timestamp;\n        const timestampassist = this.convertSecondsToHMS(timestamp);\n\n        annotation.timestampassist = timestampassist;\n        annotation.start = this.convertSecondsToHMS(this.start);\n        annotation.end = this.convertSecondsToHMS(this.end);\n        annotation.contextid = M.cfg.contextid;\n\n        $('#annotationwrapper table').hide();\n        $('#annotationwrapper').append('<div id=\"form\" class=\"w-100 p-3\"></div>');\n        const selector = document.querySelector(`#annotationwrapper #form`);\n        const decisionform = new DynamicForm(selector, self.prop.form);\n        decisionform.load(annotation);\n\n        self.onEditFormLoaded(decisionform);\n        self.validateTimestampFieldValue('timestampassist', 'timestamp');\n\n        $(document).off('click', '#cancel-submit').on('click', '#cancel-submit', function(e) {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            $('#annotationwrapper #form').remove();\n            $('#annotationwrapper table').show();\n            $('#addcontent, #importcontent').removeClass('no-pointer-events');\n        });\n\n        $(document).off('click', '#submitform-submit').on('click', '#submitform-submit', function(e) {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            const event = decisionform.trigger(decisionform.events.SUBMIT_BUTTON_PRESSED);\n            if (!event.defaultPrevented) {\n                decisionform.submitFormAjax();\n            }\n        });\n\n        decisionform.addEventListener(decisionform.events.SERVER_VALIDATION_ERROR, (e) => {\n            e.stopImmediatePropagation();\n            self.onEditFormLoaded(decisionform);\n            self.validateTimestampFieldValue('timestampassist', 'timestamp');\n        });\n\n        decisionform.addEventListener(decisionform.events.FORM_SUBMITTED, (e) => {\n            e.preventDefault();\n            e.stopImmediatePropagation();\n            this.annotations = this.annotations.filter(x => x.id != id);\n            $.ajax({\n                url: M.cfg.wwwroot + '/mod/interactivevideo/ajax.php',\n                method: \"POST\",\n                dataType: \"text\",\n                data: {\n                    action: 'get_item',\n                    id: e.detail.id,\n                    sesskey: M.cfg.sesskey,\n                    contextid: M.cfg.courseContextId,\n                    token: self.token,\n                    cmid: self.cm,\n                },\n            }).done(function(data) {\n                const updated = JSON.parse(data);\n                self.dispatchEvent('annotationupdated', {\n                    annotation: updated,\n                    action: 'edit'\n                });\n            });\n            $('#annotationwrapper #form').remove();\n            $('#annotationwrapper table').show();\n            $('#addcontent, #importcontent').removeClass('no-pointer-events');\n        });\n    }\n\n    /**\n     * Handles the loading of the edit form and initializes the destination list.\n     *\n     * @param {HTMLElement} form - The form element that is being edited.\n     * @param {Event} event - The event that triggered the form load.\n     * @returns {Object} An object containing the form and event.\n     */\n    onEditFormLoaded(form, event) {\n        let self = this;\n        let body = $('#annotationwrapper #form');\n\n        const checkContentField = () => {\n            if ($('[name=content]').length > 0) {\n                let dest = $('[name=content]').val();\n                if (dest == '' || JSON.parse(dest).length == 0) {\n                    $('#destination-list').append(`<div class=\"input-group mb-1 d-none\">\n                <label class=\"input-group-text\"><i class=\"bi bi-grip-vertical fs-unset cursor-move\"></i></label>\n                <input type=\"text\" class=\"form-control\">\n                <input type=\"text\" value=\"${this.convertSecondsToHMS(this.start)}\"\n                placeholder=\"00:00:00\" style=\"max-width: 120px;\" class=\"form-control timestamp-input\">\n                <div class=\"input-group-append\">\n                <button class=\"btn goto-dest btn-secondary px-2\" type=\"button\"><i class=\"bi bi-play-fill fs-25px\"></i></button>\n                <button class=\"btn add-dest btn-secondary\" type=\"button\"><i class=\"bi bi-plus-lg fs-unset\"></i></button>\n                <button class=\"btn btn-danger delete-dest disabled\" disabled type=\"button\">\n                    <i class=\"bi bi-trash3-fill fs-unset\"></i></button></div></div>`);\n                } else {\n                    dest = JSON.parse(dest);\n                    dest.forEach((d, i) => {\n                        $('#destination-list').append(`<div class=\"input-group mb-1\">\n                    <label class=\"input-group-text\">\n                    <i class=\"bi bi-grip-vertical cursor-move fs-unset\"></i></label>\n                    <input type=\"text\" class=\"form-control\" value=\"${d.title}\">\n                    <input type=\"text\" value=\"${this.convertSecondsToHMS(d.timestamp)}\"\n                    placeholder=\"00:00:00\" style=\"max-width: 120px;\" class=\"form-control timestamp-input\">\n                    <div class=\"input-group-append\">\n                    <button class=\"btn goto-dest btn-secondary px-2\" type=\"button\"><i class=\"bi bi-play-fill fs-25px\"></i></button>\n                    <button class=\"btn add-dest btn-secondary\" type=\"button\"><i class=\"bi bi-plus-lg fs-unset\"></i></button>\n                    <button class=\"btn btn-danger delete-dest ${i == 0 ? 'disabled' : ''}\" ${i == 0 ? 'disabled' : ''}\n                    type=\"button\"><i class=\"bi bi-trash3-fill fs-unset\"></i></button></div></div>`);\n                    });\n                    $('.input-group [type=\"text\"]').trigger('input');\n                }\n\n                $('#destination-list').sortable({\n                    items: '.input-group',\n                    cursor: 'move',\n                    update: function() {\n                        $('.input-group [type=\"text\"]').trigger('input');\n                    },\n                    stop: function() {\n                        $('.input-group .delete-dest').removeAttr('disabled');\n                        $('.input-group .delete-dest').removeClass('disabled');\n                        $('.input-group .delete-dest').first().attr('disabled', true);\n                        $('.input-group .delete-dest').first().addClass('disabled');\n                    }\n                });\n            } else {\n                requestAnimationFrame(checkContentField);\n            }\n        };\n\n        requestAnimationFrame(checkContentField);\n\n        body.off('click', '#add-destination').on('click', '#add-destination', function() {\n            const $last = $('#destination-list .input-group').last();\n            $last.find('.add-dest').trigger('click');\n        });\n\n        body.off('click', '.input-group .add-dest').on('click', '.input-group .add-dest', async function(e) {\n            e.stopImmediatePropagation();\n            let $thisrow = $(this);\n            let $parent = $thisrow.closest('.input-group');\n            let $row = $parent.clone();\n            $row.removeClass('d-none');\n            $row.find('input').val('');\n            let currentTime = await self.player.getCurrentTime();\n            $row.find('input.timestamp-input').val(self.convertSecondsToHMS(currentTime));\n            $row.find('.delete-dest').removeClass('disabled').removeAttr('disabled');\n            $parent.after($row);\n            $parent.find('[type=\"text\"]').trigger('input');\n        });\n\n        body.off('click', '.input-group .delete-dest').on('click', '.input-group .delete-dest', function(e) {\n            e.stopImmediatePropagation();\n            $(this).closest('.input-group').remove();\n            $('.input-group [type=\"text\"]').trigger('input');\n        });\n\n        body.off('click', '.input-group .goto-dest').on('click', '.input-group .goto-dest', async function(e) {\n            e.stopImmediatePropagation();\n            const timestamp = $(this).closest('.input-group').find('input.timestamp-input').val();\n            const parts = timestamp.split(':');\n            const seconds = Number(parts[0]) * 3600 + Number(parts[1]) * 60 + Number(parts[2]);\n            if (seconds >= self.start && seconds <= self.end) {\n                await self.player.seek(seconds);\n            }\n        });\n\n        body.off('contextmenu', '.input-group .timestamp-input')\n            .on('contextmenu', '.input-group .timestamp-input', async function(e) {\n                e.preventDefault();\n                e.stopImmediatePropagation();\n                // Get the current time of the video.\n                let currentTime = await self.player.getCurrentTime();\n                $(this).val(self.convertSecondsToHMS(currentTime));\n            });\n\n        body.on('input', '.input-group [type=\"text\"]', function() {\n            let dest = [];\n            $('#destination-list .input-group').each(function() {\n                const title = $(this).find('input[type=\"text\"]');\n                const timestamp = $(this).find('.timestamp-input');\n                if (title.val() != '' && timestamp.val() != ''\n                    && !title.hasClass('is-invalid') && !timestamp.hasClass('is-invalid')) {\n                    const parts = timestamp.val().split(':');\n                    const seconds = Number(parts[0]) * 3600 + Number(parts[1]) * 60 + Number(parts[2]);\n                    dest.push({\n                        title: title.val(),\n                        timestamp: seconds\n                    });\n                }\n            });\n            if (dest.length == 0) {\n                $('[name=content').val('');\n            } else {\n                $('[name=content').val(JSON.stringify(dest));\n            }\n        });\n\n        return {form, event};\n    }\n\n    /**\n     * Run the interaction\n     * @param {object} annotation The annotation object\n     * @returns {void}\n     */\n    async runInteraction(annotation) {\n        // Dismiss all tooltips.\n        $('.tooltip').remove();\n        await this.player.pause();\n        let self = this;\n        let dest = JSON.parse(annotation.content);\n        dest = dest.filter((d) => {\n            return !self.isSkipped(d.timestamp);\n        });\n\n        if (!self.isEditMode()) {\n            annotation.viewed = true;\n            this.annotations = this.annotations.filter((d) => d.id != annotation.id);\n            this.annotations.push(annotation);\n        }\n\n        if (dest.length == 0) {\n            this.player.play();\n            return;\n        }\n\n        let newannotation = JSON.parse(JSON.stringify(annotation));\n        newannotation.content = JSON.stringify(dest);\n        // We don't need to run the render method every time the content is applied. We can cache the content.\n        if (!self.cache[annotation.id] || self.isEditMode()) {\n            self.cache[annotation.id] = await this.render(newannotation, 'json');\n        }\n        const data = self.cache[annotation.id];\n        let $html = `<div class=\"position-absolute decision text-center mx-auto w-100\">\n            <h5 class=\"pt-5 pb-3 bg-white\" id=\"decision-q\">\n            <i class=\"mb-2 bi bi-signpost-split-fill\" style=\"font-size: 2em\"></i><br>${newannotation.formattedtitle}</h5>`;\n\n        data.forEach((dest, order) => {\n            $html += `<a href=\"javascript:void(0)\" data-timestamp=\"${dest.timestamp}\"\n                 data-order=\"${order}\" class=\"decision-option btn btn-outline-secondary btn-rounded mb-2 d-flex\n                  justify-content-between align-items-center mx-auto\"><span class=\"text-truncate\">${dest.title}</span>\n                  <i class=\"bi bi-chevron-right\"></i></a>`;\n        });\n        $html += '</div>';\n        let $message = $(`<div id=\"message\" style=\"z-index:1005;display:none;\" data-id=\"${annotation.id}\">\n            <div class=\"modal-body p-0 border\" id=\"content\">${$html}</div></div>`);\n        $('#video-wrapper').find(\"#message\").remove();\n        $('#video-wrapper').append($message);\n        $message.fadeIn(300, 'swing', async function() {\n            if (annotation.char1 == 1) {\n                $message.append(`<button class=\"btn btn-secondary btn-rounded position-absolute\"\n                     id=\"close-decision\" style=\"right: 1rem; top: 1rem;\">\n                     ${M.util.get_string('skip', 'local_ivdecision')}\n                     <i class=\"iv-ml-2 bi bi-chevron-right\"></i></button>`);\n            }\n            $(document).off('click', '#close-decision').on('click', '#close-decision', function(e) {\n                e.preventDefault();\n                e.stopImmediatePropagation();\n                self.player.play();\n                $('#taskinfo').fadeIn(300);\n                $('[data-region=\"chapterlists\"], #controller').removeClass('no-pointer-events');\n            });\n\n            if (!self.isEditMode()) {\n                $('#taskinfo').fadeOut(300);\n                $('[data-region=\"chapterlists\"], #controller').addClass('no-pointer-events');\n            }\n            await self.player.pause();\n        });\n\n        $(document).off('click', `#message[data-id='${annotation.id}'] .decision-option`)\n            .on('click', `#message[data-id='${annotation.id}'] .decision-option`, function(e) {\n                e.preventDefault();\n                e.stopImmediatePropagation();\n                let time = Number($(this).data('timestamp'));\n                if (time < this.start) {\n                    time = this.start;\n                } else if (time > this.end) {\n                    time = this.end;\n                }\n                self.player.seek(time);\n                $(`#message[data-id='${annotation.id}']`).fadeOut(300);\n                self.player.play();\n                $('#taskinfo').fadeIn(300);\n                $('[data-region=\"chapterlists\"], #controller').removeClass('no-pointer-events');\n            });\n    }\n}"],"names":["Decision","Base","init","this","isEditMode","isPreviewMode","decisions","annotations","filter","d","type","char1","length","self","document","on","async","e","cantSkip","viewed","sort","a","b","timestamp","removeClass","t","Number","originalEvent","detail","time","firstCantSkip","player","seek","forEach","id","addClass","addAnnotation","coursemodule","isBetweenStartAndEnd","message","M","util","get_string","convertSecondsToHMS","start","end","addNotification","isAlreadyAdded","isInSkipSegment","startHMS","endHMS","timestampHMS","data","timestampassist","title","prop","contextid","cfg","name","courseid","course","cmid","annotationid","interaction","hascompletion","hide","append","modal","selector","querySelector","decisionform","DynamicForm","form","load","onEditFormLoaded","validateTimestampFieldValue","off","preventDefault","stopImmediatePropagation","remove","show","trigger","events","SUBMIT_BUTTON_PRESSED","defaultPrevented","submitFormAjax","addEventListener","SERVER_VALIDATION_ERROR","FORM_SUBMITTED","ajax","url","wwwroot","method","dataType","action","sesskey","courseContextId","token","cm","success","newAnnotation","JSON","parse","dispatchEvent","annotation","editAnnotation","find","x","done","updated","event","body","checkContentField","dest","val","i","sortable","items","cursor","update","stop","removeAttr","first","attr","requestAnimationFrame","last","$parent","closest","$row","clone","currentTime","getCurrentTime","after","parts","split","seconds","each","hasClass","push","stringify","pause","content","isSkipped","play","newannotation","cache","render","$html","formattedtitle","order","$message","fadeIn","fadeOut"],"mappings":"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"}